{"version":3,"file":"Model.js","sourceRoot":"","sources":["../../src/three-components/Model.js"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Box3, Object3D, Vector3} from 'three';\n\nimport {CachingGLTFLoader} from './CachingGLTFLoader.js';\n\n/**\n * An Object3D that can swap out its underlying\n * model.\n *\n * @extends THREE.Object3D\n */\nexport default class Model extends Object3D {\n  /**\n   * Creates a model.\n   */\n  constructor() {\n    super();\n    this.name = 'Model';\n    this.loader = new CachingGLTFLoader();\n    this.modelContainer = new Object3D();\n    this.modelContainer.name = 'ModelContainer';\n    this.boundingBox = new Box3();\n    this.size = new Vector3();\n    this.add(this.modelContainer);\n  }\n\n  /**\n   * Returns a boolean indicating whether or not there is a\n   * loaded model attached.\n   *\n   * @return {Boolean}\n   */\n  hasModel() {\n    return !!this.modelContainer.children.length;\n  }\n\n  applyEnvironmentMap(map) {\n    this.modelContainer.traverse(obj => {\n      if (obj && obj.isMesh && obj.material) {\n        obj.material.envMap = map;\n        obj.material.needsUpdate = true;\n      }\n    });\n    this.dispatchEvent({type: 'envmap-change', value: map});\n  }\n\n  /**\n   * Pass in a THREE.Object3D to be controlled\n   * by this model.\n   *\n   * @param {THREE.Object3D}\n   */\n  setObject(model) {\n    this.clear();\n    this.modelContainer.add(model);\n    this.updateBoundingBox();\n    this.dispatchEvent({type: 'model-load'});\n  }\n\n  /**\n   * @param {String} url\n   */\n  async setSource(url) {\n    if (!url || url === this.url) {\n      return;\n    }\n\n    const scene = await this.loader.load(url);\n\n    this.clear();\n    this.url = url;\n\n    while (scene && scene.children.length) {\n      this.modelContainer.add(scene.children.shift());\n    }\n\n    this.modelContainer.traverse(obj => {\n      if (obj && obj.type === 'Mesh') {\n        obj.castShadow = true;\n      }\n    });\n\n    this.updateBoundingBox();\n\n    this.dispatchEvent({type: 'model-load'});\n  }\n\n  clear() {\n    this.url = null;\n    // Remove all current children\n    while (this.modelContainer.children.length) {\n      this.modelContainer.remove(this.modelContainer.children[0]);\n    }\n  }\n\n  updateBoundingBox() {\n    this.remove(this.modelContainer);\n    this.boundingBox.setFromObject(this.modelContainer);\n    this.boundingBox.getSize(this.size);\n    this.add(this.modelContainer);\n  }\n}\n"]}